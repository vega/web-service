<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <title>Vega GitHub Authentication Test</title>
  </head>
  <body>
    <button id="load">Authenticate</button>
    <pre id="result"></pre>
    <script type="text/javascript">
var URL = 'https://github.com/login/oauth/authorize';
var p = params();

document.getElementById('load')
  .addEventListener('click', load);

function load() {
  // setup listener for events from auth window
  function listener(evt) {
    if (!evt.data.auth) return;
    if (evt.origin === window.location.origin) {
      document.getElementById('result').innerText = JSON.stringify(evt.data);
      window.removeEventListener('message', listener);
    }
  }
  window.addEventListener('message', listener, false);

  // open auth window
  var url = URL + '?scope=gist&client_id=' + p.client_id;
  if (p.state) url += '&state=' + encodeURIComponent(p.state);
  window.open(url);
}

function params() {
  var qs = window.location.search,
      n = qs.length, p = {};
  if (n) {
    qs.slice(1, (qs[n-1]==='/' ? -1 : n))
      .split('&').forEach(function(s) {
        var nv = s.split('=').map(decodeURIComponent);
        p[nv[0]] = nv[1];
      });
  }
  return p;
}
    </script>
  </body>
</html>